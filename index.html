<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Emma & Austin's Downtown Raleigh Wedding Hotels</title>

    <!-- Leaflet + Fonts -->
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.0/dist/leaflet.css"/>
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.14.0/css/all.css">
    <link href="https://fonts.googleapis.com/css?family=Titillium+Web" rel="stylesheet">

    <style>
        html, body, #map {
            width: 100%;
            height: 100%;
            margin: 0;
            background: #ffffff;
        }

        .legend {
            line-height: 24px;
            font-size: 13px;
            width: 230px;
            color: #111111;
            padding: 8px 10px;
            background: rgba(255,255,255,0.95);
            box-shadow: 0 0 15px rgba(0,0,0,0.2);
            border-radius: 6px;
            border: 1px solid #000000;
            font-family: 'Titillium Web', sans-serif;
        }

        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.95;
        }

        .legend p {
            margin: 0 0 2px 0;
        }

        .legend b {
            display: block;
            margin-bottom: 4px;
        }

        .legend hr {
            margin: 6px 0;
            border: none;
            border-top: 1px solid #cccccc;
        }

        /* Popup styling */
        .popup-title {
            font-family: 'Titillium Web', sans-serif;
            font-size: 16px;
            font-weight: 700;
            margin: 0 0 4px 0;
            color: #4B0A18; /* burgundy */
        }

        .popup-body {
            font-family: 'Titillium Web', sans-serif;
            font-size: 13px;
        }

        .popup-stars {
            color: #D4AF37; /* gold-ish */
            margin-bottom: 4px;
        }

        .popup-link a {
            color: #7B112C; /* wine red */
            text-decoration: none;
            font-weight: 600;
        }

        .popup-link a:hover {
            text-decoration: underline;
        }
    </style>

    <!-- JS libraries -->
    <script src="https://unpkg.com/leaflet@1.7.0/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
</head>

<body>
<div id="map"></div>

<script>
// 1. Map centered on downtown Raleigh / wedding area
var mymap = L.map('map', {
    center: [35.7786, -78.6378],
    zoom: 15,
    maxZoom: 18,
    minZoom: 13,
    detectRetina: true
});

// 2. Clean basemap
L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png', {
    attribution: '&copy; OpenStreetMap contributors &copy; CARTO'
}).addTo(mymap);

// 3. Wedding color palette (white → burgundy → wine red → black)
var weddingColors = chroma
    .scale(['#EDE5DD', '#4B0A18', '#7B112C', '#000000'])  // off-white instead of pure white
    .mode('lch')
    .colors(4);

// marker-color-1 (cheapest hotels) – white with black outline
$('head').append(
    "<style>.marker-color-1 { color: " + weddingColors[0] +
    "; font-size: 18px; text-shadow: 0 0 3px #000000; }</style>"
);

// marker-color-2–4 – darker colors with white outline
$('head').append(
    "<style>.marker-color-2 { color: " + weddingColors[1] +
    "; font-size: 18px; text-shadow: 0 0 3px #ffffff; }</style>"
);
$('head').append(
    "<style>.marker-color-3 { color: " + weddingColors[2] +
    "; font-size: 18px; text-shadow: 0 0 3px #ffffff; }</style>"
);
$('head').append(
    "<style>.marker-color-4 { color: " + weddingColors[3] +
    "; font-size: 18px; text-shadow: 0 0 3px #ffffff; }</style>"
);

// Add special class for the wedding venue (heart icon)
$('head').append(
    "<style> .marker-venue { color: #7B112C; font-size: 26px; text-shadow: 0 0 4px #ffffff; } </style>"
);

// Helper: price category breaks for hotels
function getPriceCategory(price) {
    if (price < 175) {
        return 1; // under $175
    } else if (price >= 175 && price < 225) {
        return 2; // 175–224
    } else if (price >= 225 && price < 300) {
        return 3; // 225–299
    } else {
        return 4; // 300+
    }
}

// Helper: build star icons string
function buildStars(rating) {
    if (!rating || isNaN(rating)) return 'No reviews';
    var fullStars = Math.round(rating);
    var starsHtml = '';

    for (var i = 0; i < fullStars; i++) {
        starsHtml += '<i class="fas fa-star"></i>';
    }
    for (var j = fullStars; j < 5; j++) {
        starsHtml += '<i class="far fa-star"></i>';
    }
    return starsHtml + ' (' + rating.toFixed(1) + ' / 5)';
}

// 4. Hotels layer
var hotel_listings = L.geoJson.ajax("assets/downtown_raleigh_hotels.geojson", {
    onEachFeature: function (feature, layer) {
        var p = feature.properties || {};

        var name    = p.name || 'Hotel';

// always try to parse stars as a number
var rating  = parseFloat(p.stars);
if (isNaN(rating)) {
    rating = null;
}

var avgCost = p.avg_cost;
var website = p.website || null;

        // Clean numeric cost
        if (typeof avgCost === 'string') {
            avgCost = parseFloat(avgCost.replace(/[^0-9.]/g, ''));
        }

        var starsHtml = buildStars(rating || 0);
        var costHtml  = (avgCost && !isNaN(avgCost)) ?
                        ('$' + avgCost.toFixed(0) + ' per night (avg.)') :
                        'Cost not available';

        var popupContent =
            '<div class="popup-body">' +
                '<h3 class="popup-title">' + name + '</h3>' +
                '<div class="popup-stars">' + starsHtml + '</div>' +
                '<div><strong>Average Rate:</strong> ' + costHtml + '</div>';

        if (website) {
            popupContent +=
                '<div class="popup-link" style="margin-top:4px;">' +
                '<strong>Website: </strong>' +
                '<a href="' + website + '" target="_blank" rel="noopener noreferrer">View hotel site</a>' +
                '</div>';
        }

        popupContent +=
            '<div style="margin-top:6px; font-size:11px; color:#555;">' +
            'Recommended stay options for Emma Watkins &amp; Austin Gifford’s wedding in downtown Raleigh.' +
            '</div>' +
            '</div>';

        layer.bindPopup(popupContent);
    },

    pointToLayer: function (feature, latlng) {
        var p = feature.properties || {};
        var priceVal = p.avg_cost;

        if (typeof priceVal === 'string') {
            priceVal = parseFloat(priceVal.replace(/[^0-9.]/g, ''));
        }

        var cat = 2;
        if (typeof priceVal === 'number' && !isNaN(priceVal)) {
            cat = getPriceCategory(priceVal);
        }

        return L.marker(latlng, {
            icon: L.divIcon({
                className: 'fas fa-hotel marker-color-' + cat.toString()
            })
        });
    },

    attribution:
        'Hotels © OpenStreetMap contributors | Map for Emma &amp; Austin’s wedding by Zach Watkins'
}).addTo(mymap);

// 5. Wedding venue layer
var weddingVenue = L.geoJson.ajax("assets/wedding_venue.geojson", {
    pointToLayer: function(feature, latlng) {
        return L.marker(latlng, {
            icon: L.divIcon({
                className: 'fas fa-heart marker-venue'
            })
        });
    },
    onEachFeature: function(feature, layer) {
        var p = feature.properties || {};
        var name = p.name || "Wedding Venue";

        var popupContent =
            '<div class="popup-body">' +
            '<h3 class="popup-title">' + name + '</h3>' +
            '<div>Venue for <strong>Emma Watkins &amp; Austin Gifford</strong>.</div>' +
            '</div>';

        layer.bindPopup(popupContent);
    }
}).addTo(mymap);

// 6. Legend
var legend = L.control({position: 'topright'});

legend.onAdd = function () {
    var div = L.DomUtil.create('div', 'legend');

    div.innerHTML += '<b>Wedding Hotels – Downtown Raleigh</b>';
    div.innerHTML += '<p style="font-size:12px;">For guests of Emma Watkins &amp; Austin Gifford</p>';
    div.innerHTML += '<hr>';
    div.innerHTML += '<b>Average Nightly Rate</b><br>';
    div.innerHTML += '<i class="fas fa-hotel marker-color-1"></i><p>Under $175</p>';
    div.innerHTML += '<i class="fas fa-hotel marker-color-2"></i><p>$175 – $224</p>';
    div.innerHTML += '<i class="fas fa-hotel marker-color-3"></i><p>$225 – $299</p>';
    div.innerHTML += '<i class="fas fa-hotel marker-color-4"></i><p>$300 and up</p>';
    div.innerHTML += '<hr>';
    div.innerHTML += '<i class="fas fa-heart marker-venue"></i><p>Wedding Venue</p>';

    return div;
};

legend.addTo(mymap);

// 7. Scale bar
L.control.scale({position: 'bottomleft'}).addTo(mymap);
</script>
</body>
</html>